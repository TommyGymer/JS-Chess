<html>
	<head>
		<style>
			table.board{
				margin: 0px;
			}
			table.board tr{
				margin: 0px;
			}
			table.board tr td{
				margin: 0px;
			}
			table.board tr td div{
				width: 64px;
				height: 64px;
				margin: 0px;
			}
			table.board tr td div.light{
				background-color: #ffeeee;
			}
			table.board tr td div.dark{
				background-color: #ccffcc;
			}
			table.board tr td div.sel{
				background-color: #ffff99;
			}
			table.board tr td div.move{
				background-color: #dddddf;
			}
			table.board tr td div.moved{
				background-color: #ccccee;
			}
			table.board tr td div.pawn_move{
				background-color: #dddddf;
			}
			table.board tr td div.option{
				background-color: #efefef;
				width: 32px;
				height: 32px;
				border-radius: 8px;
				border-width: 2px;
				border-color: black;
				border-style: solid;
			}
			table.board tr td div.option span{
				font-size: 32px;
				margin: 0;
				padding: 0;
				position: relative;
				top: -7px;
				left: 0;
			}
			table.board tr td div span{
				font-size: 48px;
				padding-left: 8px;
				cursor: default;
			}
			div.promotion{
				position: absolute;
				top:  6px;
				left: 3px;
			}
			.hidden{
				visibility:  hidden;
			}
		</style>
	</head>

	<body>
		<table class="board" id="board">
		</table>
		<div class="promotion hidden" id="divPromote">
			<table class="board">
				<tr>
					<td><div class="option"><span>♖</span></div></td>
					<td><div class="option"><span>♗</span></div></td>
					<td><div class="option"><span>♕</span></div></td>
				</tr>
			</table>
		</div>

		<script type="text/javascript">
			//gets the table with id = board
			let board = document.getElementById("board");
			//defines the column names
			let cols = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];
			//pieces
			let pie = ['♔', '♚', '♕', '♛', '♖', '♜', '♗', '♝', '♘', '♞', '♙', '♟︎'];
			//init board state
			/*let state = [
				[5, 9, 7, 3, 1, 7, 9, 5],
				[11, 11, 11, 11, 11, 11, 11, 11],
				[],
				[],
				[],
				[],
				[10, 10, 10, 10, 10, 10, 10, 10],
				[4, 8, 6, 2, 0, 6, 8, 4]
			];*/
			let state = [
				[],
				[],
				[10, 10, 10, 10, 10, 10, 10, 10],
				[],
				[],
				[11, 11, 11, 11, 11, 11, 11, 11],
				[],
				[]
			];
			let turn = 1;
			//initialise the board
			for(let i = 0; i < 8; i++){
				//add a row
				let row = document.createElement("tr");
				board.append(row);
				for(let j = 0; j < 8; j++){
					//add a column to the row
					let col = document.createElement("td");
					row.append(col);
					//add a div to the column
					let div = document.createElement("div");
					col.append(div);
					//add the piece icon to the div
					let p = document.createElement("span");
					p.innerText = pie[state[i][j]] || " ";
					div.append(p);
					//add a click listener to each div
					div.addEventListener("click", () => {
						let divs = document.getElementsByTagName('div');
						let moving = false;
						let de_sel = false;
						let moved = false;
						if(p.innerText == ""){
							//check for move
							if(div.classList.contains("move")){
								for(let k = 0; k < divs.length; k++){
									if(divs[k].classList.contains("sel")){
										//check the move is possible using a straight line between the start and end points
										let to_col = parseInt(j) + 1;
										let to_row = parseInt(8 - i);
										let from_col = parseInt(cols.indexOf(divs[k].classList[0])) + 1;
										let from_row = parseInt(divs[k].classList[1]);
										let move_possible = true;
										if(((Math.abs(to_row - from_row) == Math.abs(to_col - from_col)) | (to_row == from_row) | (to_col == from_col))){
											let row_dir = -((to_row - from_row) / Math.abs(to_row - from_row)) || 0;
											let col_dir = ((to_col - from_col) / Math.abs(to_col - from_col)) || 0;
											for(let check = 1; (check < Math.abs(to_row - from_row)) | (check < Math.abs(to_col - from_col)); check++){
												let c_c = cols[from_col + (check * col_dir) - 1];
												let c_r = parseInt(from_row) + (check * -row_dir);
												let cdiv = document.getElementsByClassName(c_c + " " + c_r)[0];
												let c_span = cdiv.getElementsByTagName("span")[0];
												if(c_span.innerText != ""){
													move_possible = false;
												}
											}
										}
										if(move_possible){
											let span = divs[k].getElementsByTagName("span")[0];
											p.innerText = span.innerText;
											span.innerText = "";
											moved = true;
										}
									}
								}
								moving = true;
							}else{
								de_sel = true;
							}
						}else if(div.classList.contains("move") || div.classList.contains("pawn_move")){
							//take piece
							let from_type = pie.indexOf(div.innerText) % 2
							for(let k = 0; k < divs.length; k++){
								if(divs[k].classList.contains("sel")){
									//check the move is possible using a straight line between the start and end points
									let to_col = parseInt(j) + 1;
									let to_row = parseInt(8 - i);
									let from_col = parseInt(cols.indexOf(divs[k].classList[0])) + 1;
									let from_row = parseInt(divs[k].classList[1]);
									let move_possible = true;
									if(((Math.abs(to_row - from_row) == Math.abs(to_col - from_col)) | (to_row == from_row) | (to_col == from_col))){
										let row_dir = -((to_row - from_row) / Math.abs(to_row - from_row)) || 0;
										let col_dir = ((to_col - from_col) / Math.abs(to_col - from_col)) || 0;
										for(let check = 1; (check < Math.abs(to_row - from_row)) | (check < Math.abs(to_col - from_col)); check++){
											let c_c = cols[from_col + (check * col_dir) - 1];
											let c_r = parseInt(from_row) + (check * -row_dir);
											let cdiv = document.getElementsByClassName(c_c + " " + c_r)[0];
											let c_span = cdiv.getElementsByTagName("span")[0];
											if(c_span.innerText != ""){
												move_possible = false;
											}
										}
									}
									
									if((Math.floor(pie.indexOf(divs[k].innerText)/2) == 5 & !div.classList.contains("pawn_move")) | !move_possible){
									}else if((from_type != pie.indexOf(divs[k].innerText) % 2) && move_possible){
										let span = divs[k].getElementsByTagName("span")[0];
										p.innerText = span.innerText;
										span.innerText = "";
										moved = true;
									}

									//check for promotions, and display promotion interface
									if(div.classList.contains("promote")){
										
									}
									document.getElementById("promotion")
								}
							}
							moving = true;
						}
						for(let k = 0; k < divs.length; k++){
							divs[k].classList.remove("sel");
							divs[k].classList.remove("move");
							divs[k].classList.remove("moved");
							divs[k].classList.remove("pawn_move");
							divs[k].classList.remove("promote");
						}
						if(!moving){
							 if(!de_sel){
							 	div.classList.add("sel");
							 }else{
							 	return;
							 }
						}else if(moved){
							div.classList.add("moved");
							turn = (turn + 1) % 2;
							return;
						}

						//add possible move markers
						let pos = document.getElementsByClassName(cols[j] + " " + (8 - i).toString())[0].getElementsByTagName("span")[0];
						let type = Math.floor(pie.indexOf(pos.innerText) / 2);
						if(turn == pie.indexOf(pos.innerText) % 2){return;}
						switch(type){
							case 0:
								for(let k = 0; k < divs.length; k++){
									let c = cols.indexOf(divs[k].classList[0]);
									let r = 8 - divs[k].classList[1];
									let dist = Math.sqrt(Math.pow(i-r,2) + Math.pow(j-c,2));
									if(dist < 1.5 && dist > 0.1){
										divs[k].classList.add("move");
									}
								}
								break;
							case 1:
								for(let k = 0; k < divs.length; k++){
									let c = cols.indexOf(divs[k].classList[0]);
									let r = 8 - divs[k].classList[1];
									if(((c == j || r == i) || (Math.abs(i-r) == Math.abs(j-c))) && !(c == j && r == i)){
										divs[k].classList.add("move");
									}
								}
								break;
							case 2:
								for(let k = 0; k < divs.length; k++){
									let c = cols.indexOf(divs[k].classList[0]);
									let r = 8 - divs[k].classList[1];
									if(((c == j || r == i)) && !(c == j && r == i)){
										divs[k].classList.add("move");
									}
								}
								break;
							case 3:
								for(let k = 0; k < divs.length; k++){
									let c = cols.indexOf(divs[k].classList[0]);
									let r = 8 - divs[k].classList[1];
									if(((Math.abs(i-r) == Math.abs(j-c))) && !(c == j && r == i)){
										divs[k].classList.add("move");
									}
								}
								break;
							case 4:
								for(let k = 0; k < divs.length; k++){
									let c = cols.indexOf(divs[k].classList[0]);
									let r = 8 - divs[k].classList[1];
									let dist = Math.sqrt(Math.pow(i-r,2) + Math.pow(j-c,2));
									if(dist < 2.5 && dist > 2){
										divs[k].classList.add("move");
									}
								}
								break;
							case 5:
								for(let k = 0; k < divs.length; k++){
									let c = cols.indexOf(divs[k].classList[0]);
									let r = 8 - divs[k].classList[1];
									let side = -(pie.indexOf(pos.innerText) % 2) + 0.5;
									if(!(c == j && r == i) && (j == c && ((i - r) * side < 1 + (0.5 * ((-2 * side) * (3.5 - r) > 0)))) && ((i * side) > (r * side))){
										divs[k].classList.add("move");
									}
									if(Math.abs(c - j) == 1 && (i - r) == side * 2){
										divs[k].classList.add("pawn_move");
									}
									if(i == (3.5 + 5 * -side) && j == c){
										document.getElementsByClassName(cols[j] + " " + (8 - i + 2 * side).toString())[0].classList.add("promote");
									}
								}
								break;
						}
					});
					//add the location as a class
					div.classList.add(cols[j]);
					div.classList.add(String(8-i));
					//add the colour to the div
					if((j+(i%2))%2==0){
						div.classList.add("light");
					}else{
						div.classList.add("dark");
					}
				}
			}
		</script>
	</body>
</html>